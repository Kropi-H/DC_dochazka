<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>{{ page_title }}</title>
<script src="https://code.jquery.com/jquery-3.6.0.js"></script>
<script src="https://code.jquery.com/ui/1.13.2/jquery-ui.js"></script>
<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">
<link href="{{ url_for('static', filename = 'theme_zakazky.css' )}}" rel="stylesheet">
</head>
<body>
<div class="container">
    <div class="panel panel-default">
        <!-- Default panel contents -->
        <div class="panel-heading"><h1>Seznam zakázek</h1>
            <div>
                <span class="label label-primary">Řezání celkem: {{ cut_count }} minut</span>
                <span class="label label-primary">Lepení celkem: {{ glue_count }} metrů</span>
            </div>
        </div>

        <!-- Table -->
        <div class="panel panel-default" style="overflow-x:auto;">
            <table class="table table-bordered table-hover table-sortable table-striped">
                <thead>
                <form action="/add_contract" method="POST">
                    <tr class="table-info">
                        <th>Zakázka</th>
                        {{ form.csrt_token }}
                        {{ form.hidden_tag() }}
                        <th>{{ form.customer_name }}{{ form.hidden_tag() }}</th>
                        <th>{{ form.customer_note }}{{ form.hidden_tag() }}</th>
                        <th>
                            <div>{{ form.customer_cut }}{{ form.hidden_tag() }}</div>
                            <div>{{ form.customer_glue }}{{ form.hidden_tag() }}</div>
                        </th>
                        <th>Stav</th>
                        <th>
                            {{ form.customer_date_finish.label(class='form-control-label', for='customer_date_finish') }}
                            {{ form.customer_date_finish }}{{ form.hidden_tag() }}
                        </th>
                        <th>
                        {{ form.submit(class="btn btn-success") }}
                    </tr>
                </form>
                </thead>
                <tbody id="task-list">
                {% for contract in contracts %}
                {% if contract['finished'] == 0 %}
                <tr draggable="true" ondragstart="dragStart(event)" ondragover="dragOver(event)"
                    ondrop="drop(event, {{ loop.index0 }})" data-index="{{ loop.index0 }}">
                    <td scope="row">DC{{ contract['id'] }}</td>
                    <td>{{ contract['contract'] }}</td>
                    <td>{{ contract['note'] }}</td>
                    <td>
                        {% if contract['cut'] > 0 %}<div><label><input type="checkbox"> {{ contract['cut'] }} minut</label></div>{% endif %}
                        {% if contract['glue'] > 0 %}<div><label><input type="checkbox"> {{ contract['glue'] }} metrů</label></div>{% endif %}
                    </td>
                    <td>
                        <div class="progress">
                            <div class="progress-bar" role="progressbar" aria-valuenow="70"
                                 aria-valuemin="0" aria-valuemax="100" style="width:70%">
                                70%
                            </div>
                        </div>
                    </td>
                    <td>{{ contract['date_create'] }} / {{ contract['date'] }}</td>
                    <td>{% if not contract['finished'] %}
                        <!--<button class="btn btn-success float-right" onclick="completeContract({{ loop.index0 }})">
                            Uspokojeno
                        </button>-->
                        <button class="btn btn-danger glyphicon glyphicon-remove"
                                onclick="completeContract({{ loop.index0 }})"></button>
                        <button class="btn btn-warning glyphicon glyphicon-print"></button>
                        {% endif %}
                    </td>
                </tr>
                {% endif %}
                {% endfor %}
                </tbody>
            </table>
        </div>

        <!--<form action="/archive_contracts" method="GET">
            <button class="btn btn-success" type="submit">Archivovat uspokojené zákazníky</button>
        </form>-->
        <button class="btn btn-warning order_btn" class="btn" onclick="updateContractOrder()">Uložit pořadí</button>

    </div>
</div>
<script>

$( function() {
  $( "#task-list" ).sortable();
});

        function completeContract(contractIndex) {
            $.get(`/complete_contract/${contractIndex}`, function() {
                location.reload();
            });
        }

        function updateContractOrder() {
            var taskList = document.getElementById('task-list');
            var items = Array.from(taskList.children);
            var newOrder = items.map(function (item) {
                return item.dataset.index;
            });

            $.ajax({
                url: '/update_contract_order',
                type: 'POST',
                data: { contract_order: newOrder },
                success: function () {
                    // Po úspěšném uložení můžete provést nějakou akci, například zobrazení zprávy o úspěchu.
                }
            });
        }








</script>
</body>
</html>
